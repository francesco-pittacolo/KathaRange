lab:
  description: "KatharaRange-API"
  version: "1.0"
  author: "F. Pittacolo"

devices:
  # ===============================
  # Routers
  # ===============================
  r1:
    image: kathara/quagga
    interfaces:
      eth0: A1
      eth1: A

  r2:
    image: kathara/quagga
    interfaces:
      eth0: B
      eth1: B1

  r3:
    image: kathara/quagga
    interfaces:
      eth0: C
      eth1: C1

  r4:
    image: kathara/quagga
    interfaces:
      eth0: D
    options:
      bridged: true

  r5:
    image: snort:3.1.1-kathaRange
    interfaces:
      eth0: A
      eth1: B
      eth2: C
      eth3: D

  # ===============================
  # Servers
  # ===============================
  apache2_1:
    image: kathara/base
    interfaces:
      eth0: A1

  apache2_2:
    image: vuln_apache:2.4.9-kathaRange
    interfaces:
      eth0: C1

  tomcat2_1:
    image: tomcat:9.0.0-kathaRange
    interfaces:
      eth0: A1

  tomcat2_2:
    image: tomcat:9.0.0-kathaRange
    interfaces:
      eth0: C1

  # ===============================
  # Workstations
  # ===============================
  pc1:
    image: kathara/base
    interfaces:
      eth0: B1

  script_2_1:
    image: kathara/base
    interfaces:
      eth0: B1

  kali:
    image: kali:1.0.0-kathaRange
    interfaces:
      eth0: B1


  caldera:
    image: caldera:5.0.0-kathaRange
    interfaces:
      eth0: B1
    options:
      bridged: true
      ports:
        - "8888:8888/tcp"

  # ===============================
  # Wazuh Setup
  # ===============================
  wazuh_indexer:
    image: wazuh/wazuh-indexer:4.9.0
    interfaces:
      eth0: C1
    options:
      bridged: true
      envs:
        - "OPENSEARCH_JAVA_OPTS=-Xms2048m -Xmx4096m"
        - "INDEXER_IP=192.168.2.22"
        - "MANAGER_IP=192.168.2.23"
      ports:
        - "9200:9200/tcp"
      ulimits:
        - "memlock=-1:-1"
        - "nofile=655360:655360"

  wazuh_manager:
    image: wazuh/wazuh-manager:4.9.0
    interfaces:
      eth0: C1
    options:
      bridged: true
      envs:
        - "INDEXER_URL=https://wazuh.indexer:9200"
        - "INDEXER_USERNAME=admin"
        - "INDEXER_PASSWORD=SecretPassword"
        - "FILEBEAT_SSL_VERIFICATION_MODE=full"
        - "SSL_CERTIFICATE_AUTHORITIES=/etc/ssl/root-ca.pem"
        - "SSL_CERTIFICATE=/etc/ssl/filebeat.pem"
        - "SSL_KEY=/etc/ssl/filebeat.key"
        - "API_USERNAME=wazuh-wui"
        - "API_PASSWORD=MyS3cr37P450r.*-"
        - "INDEXER_IP=192.168.2.22"
        - "MANAGER_IP=192.168.2.23"
      ports:
        - "1514:1514"
        - "1515:1515"
        - "514:514/udp"
        - "55000:55000"
      ulimits:
        - "memlock=-1:-1"
        - "nofile=655360:655360"

  wazuh_dashboard:
    image: wazuh/wazuh-dashboard:4.9.0
    interfaces:
      eth0: C1
    options:
      envs:
        - "INDEXER_USERNAME=admin"
        - "INDEXER_PASSWORD=SecretPassword"
        - "SERVER_SSL_ENABLED=false"
        - "WAZUH_API_URL=https://wazuh.manager"
        - "DASHBOARD_USERNAME=kibanaserver"
        - "DASHBOARD_PASSWORD=kibanaserver"
        - "API_USERNAME=wazuh-wui"
        - "API_PASSWORD=MyS3cr37P450r.*-"
        - "INDEXER_IP=192.168.2.22"
        - "MANAGER_IP=192.168.2.23"
      bridged: true
      ports:
        - "443:5601/tcp"
